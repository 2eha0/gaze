---
/**
 * Universal Widget Container
 * Provides a consistent wrapper for all widget types with header and error handling
 */

import { getWidget } from '../lib/registry'
import type { WidgetProps } from '../types/widget'
import { WidgetError } from './WidgetError'

interface Props extends WidgetProps {}

const { config, data } = Astro.props

// Check if data is an error
const isError = data && typeof data === 'object' && 'error' in data
const errorMessage = isError && 'message' in data ? String(data.message) : 'Failed to fetch data'

// Get widget definition from registry
const widgetDef = getWidget(config.type)
const WidgetComponent = widgetDef?.component
---

<div class="widget-container glass rounded-lg overflow-hidden" data-widget-type={config.type} data-widget-slug={config.slug}>
  {/* Widget Header */}
  {!config.hideHeader && config.title && (
    <div class="widget-header border-b border-white/10 px-6 py-4">
      <h2 class="text-lg font-semibold text-white/90">{config.title}</h2>
    </div>
  )}

  {/* Widget Content */}
  <div class="widget-content p-6">
    {isError ? (
      <WidgetError widgetType={config.type} error={errorMessage} client:load />
    ) : !WidgetComponent ? (
      <div class="text-white/50">
        <p class="text-sm">Unknown widget type: {config.type}</p>
        <p class="text-xs mt-2">Widget not registered in the registry</p>
      </div>
    ) : (
      <WidgetComponent config={config} data={data} />
    )}
  </div>
</div>

<style>
  .widget-container {
    height: fit-content;
  }
</style>
